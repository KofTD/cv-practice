# Практическая работа №1. Обработка изображений с использованием библиотеки OpenCV

---

## 1. `resize_image(image, new_h=None, new_w=None, scale=None)`
**Назначение**: Изменяет размер изображения методом ближайшего соседа.

**Параметры**:
- `image`: Входное изображение (RGB, NumPy массив).
- `new_h`, `new_w` (int, опционально): Новые высота и ширина изображения.
- `scale` (float, опционально): Коэффициент масштабирования.

**Логика**:
- Вычисляет новые размеры на основе переданных параметров.
- Использует векторизованный расчет индексов для оптимизации.
- Создает массив результата с пикселями из ближайших координат.

**Выход**: Изображение нового размера (RGB, `uint8`).

---

## 2. `sepia_effect(image)`
**Назначение**: Применяет эффект сепии для винтажного оттенка.

**Параметры**:
- `image`: Входное изображение (RGB, NumPy массив).

**Логика**:
- Использует матрицу сепии для преобразования RGB.
- Преобразует изображение в `float32`, применяет матрицу, обрезает значения до [0, 255].

**Выход**: Изображение с сепией (RGB, `uint8`).

---

## 3. `vignette_effect(image, strength=0.5)`
**Назначение**: Создает эффект виньетки, затемняя края.

**Параметры**:
- `image`: Входное изображение (RGB, NumPy массив).
- `strength` (float, по умолчанию 0.5): Сила затемнения.

**Логика**:
- Создает гауссову маску для затемнения краев.
- Умножает каждый канал изображения на маску.
- Обрезает значения до [0, 255].

**Выход**: Изображение с виньеткой (RGB, `uint8`).

---

## 4. `pixelate_region(image, x, y, w, h, pixel_size=10)`
**Назначение**: Пикселизирует заданную область изображения.

**Параметры**:
- `image`: Входное изображение (RGB, NumPy массив).
- `x`, `y`, `w`, `h` (int): Координаты и размеры области.
- `pixel_size` (int, по умолчанию 10): Размер блока пикселизации.

**Логика**:
- Разбивает область на блоки `pixel_size x pixel_size`.
- Заменяет каждый блок средним цветом.
- Проверяет границы изображения.

**Выход**: Изображение с пикселизированной областью (RGB, `uint8`).

---

## 5. `pixelate_whole_image(image, pixel_size=10)`
**Назначение**: Пикселизирует все изображение.

**Параметры**:
- `image`: Входное изображение (RGB, NumPy массив).
- `pixel_size` (int, по умолчанию 10): Размер блока пикселизации.

**Логика**:
- Вызывает `pixelate_region` для всего изображения.

**Выход**: Пикселизированное изображение (RGB, `uint8`).

---

## 6. `start_pixelate_interactive(image, initial_pixel_size=10)`
**Назначение**: Запускает интерактивный режим пикселизации.

**Параметры**:
- `image`: Входное изображение (RGB, NumPy массив).
- `initial_pixel_size` (int, по умолчанию 10): Начальный размер пикселя.

**Логика**:
- Создает окно для интерактивного выбора области.
- Регистрирует callback для обработки событий мыши.
- Позволяет изменять размер пикселя и сбрасывать изображение.

**Выход**: Изображение с примененной пикселизацией (RGB, `uint8`).

---

## 7. `mouse_callback_pixelate(event, x, y, flags, param)`
**Назначение**: Обрабатывает события мыши в интерактивном режиме пикселизации.

**Параметры**:
- `event`: Тип события мыши.
- `x`, `y`: Координаты курсора.
- `flags`: Флаги события.
- `param`: Дополнительные параметры.

**Логика**:
- Обрабатывает нажатие, движение и отпускание кнопки мыши.
- Отображает предварительный просмотр выделяемой области.
- Применяет пикселизацию при отпускании кнопки.

---

## 8. `add_rectangular_border(image, color=(0,255,0), thickness=30)`
**Назначение**: Добавляет прямоугольную рамку заданного цвета.

**Параметры**:
- `image`: Входное изображение (RGB, NumPy массив).
- `color` (tuple, по умолчанию (0,255,0)): Цвет рамки (зеленый).
- `thickness` (int, по умолчанию 30): Толщина рамки.

**Логика**:
- Создает копию изображения.
- Заполняет края (верх, низ, лево, право) указанным цветом.

**Выход**: Изображение с рамкой (RGB, `uint8`).

---

## 9. `add_shape_border(image, color=(255,0,0), thickness=25, shape_type='ellipse')`
**Назначение**: Добавляет фигурную рамку (эллипс, круг, ромб).

**Параметры**:
- `image`: Входное изображение (RGB, NumPy массив).
- `color` (tuple, по умолчанию (255,0,0)): Цвет рамки (красный).
- `thickness` (int, по умолчанию 25): Толщина рамки.
- `shape_type` (str, по умолчанию 'ellipse'): Тип рамки ('ellipse', 'circle', 'diamond').

**Логика**:
- Создает маску для рамки с помощью уравнений эллипса, круга или ромба.
- Применяет цвет рамки к пикселям маски.

**Выход**: Изображение с фигурной рамкой (RGB, `uint8`).

---

## 10. `lens_flare_texture(image, flare_image_path=None, flare_center=(0.5, 0.5), intensity=1.0, blend_mode='add')`
**Назначение**: Добавляет эффект блика линзы с использованием текстуры.

**Параметры**:
- `image`: Входное изображение (RGB, NumPy массив).
- `flare_image_path` (str, опционально): Путь к текстуре блика.
- `flare_center` (tuple, по умолчанию (0.5,0.5)): Центр блика (нормализованные координаты).
- `intensity` (float, по умолчанию 1.0): Сила блика.
- `blend_mode` (str, по умолчанию 'add'): Режим наложения ('add', 'screen', 'lighten').

**Логика**:
- Загружает и масштабирует текстуру блика.
- Позиционирует текстуру относительно центра.
- Применяет блик с учетом альфа-канала и выбранного режима наложения.
- Обрезает значения до [0, 255].

**Выход**: Изображение с бликом (RGB, `uint8`).

---

## 11. `lens_flare_standard(image, flare_center=(0.5, 0.5), intensity=1.0)`
**Назначение**: Добавляет стандартный эффект блика линзы (резервный вариант).

**Параметры**:
- `image`: Входное изображение (RGB, NumPy массив).
- `flare_center` (tuple, по умолчанию (0.5,0.5)): Центр блика (нормализованные координаты).
- `intensity` (float, по умолчанию 1.0): Сила блика.

**Логика**:
- Создает гауссовы маски для радиального свечения.
- Добавляет желтоватый блик к изображению.
- Обрезает значения до [0, 255].

**Выход**: Изображение с бликом (RGB, `uint8`).

---

## 12. `watercolor_paper_texture(image, paper_texture_path)`
**Назначение**: Применяет текстуру акварельной бумаги.

**Параметры**:
- `image`: Входное изображение (RGB, NumPy массив).
- `paper_texture_path` (str): Путь к текстуре бумаги.

**Логика**:
- Загружает текстуру бумаги и масштабирует ее до размеров изображения.
- Преобразует в `float32` и нормализует.
- Применяет текстуру к изображению с фиксированным коэффициентом.
- Обрезает значения до [0, 255].

**Выход**: Изображение с текстурой (RGB, `uint8`).

---

## 13. `apply_filter(image, filter_type, *args)`
**Назначение**: Применяет указанный фильтр к изображению.

**Параметры**:
- `image`: Входное изображение (RGB, NumPy массив).
- `filter_type` (str): Тип фильтра ('resize', 'sepia', 'vignette', 'pixelate', 'rect_border', 'shape_border', 'lens_flare', 'watercolor').
- `*args`: Параметры фильтра.

**Логика**:
- Проверяет тип фильтра и вызывает соответствующую функцию.
- Обрабатывает параметры с значениями по умолчанию.
- Для пикселизации поддерживает три режима: интерактивный, всей картинки, области.
- Для блика линзы поддерживает два режима: с текстурой и стандартный.
- Вызывает ошибку для неизвестного фильтра.

**Выход**: Изображение с фильтром (RGB, `uint8`).

---

## 14. `main()`
**Назначение**: Обрабатывает аргументы командной строки и отображает результат.

**Параметры**: Нет

**Логика**:
- Проверяет аргументы (путь к изображению, тип фильтра, параметры).
- Загружает изображение через `cv2.imread`.
- Применяет фильтр через `apply_filter`.
- Для не-интерактивных фильтров отображает исходное и обработанное изображения.

**Выход**: Нет (отображает изображения в окнах).

---

## Примеры использования

Скрипт запускается из командной строки, указывая путь к изображению, тип фильтра и параметры.

### Основные команды:
```bash
# Изменение размера
python filters.py image.jpg resize 0.5
python filters.py image.jpg resize 400 300

# Эффект сепии
python filters.py image.jpg sepia

# Виньетка
python filters.py image.jpg vignette 0.7

# Пикселизация
python filters.py image.jpg pixelate                    # интерактивный режим
python filters.py image.jpg pixelate 15                 # вся картинка с размером пикселя 15
python filters.py image.jpg pixelate 100 50 200 150     # область 100,50,200,150
python filters.py image.jpg pixelate 100 50 200 150 12  # область с размером пикселя 12

# Рамки
python filters.py image.jpg rect_border 20 255 0 0
python filters.py image.jpg shape_border 25 0 255 0 ellipse

# Блик линзы
python filters.py image.jpg lens_flare
python filters.py image.jpg lens_flare flare_texture.png 0.5 0.5 1.2 screen

# Акварельная текстура
python filters.py image.jpg watercolor paper_texture.jpg
